{% extends 'app-layout.html.twig' %}

{% block content %}
  <div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
      <h1 class="text-2xl font-bold">
        My Tasks
      </h1>

      <p class="mt-2 text-sm text-gray-700">
        All tasks that have been assigned to you across different teams.
      </p>
    </div>
    <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
      <a href="{{ path('app_task_create') }}"
        class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
        Create task
      </a>
    </div>
  </div>

  {% if tasks is empty %}
    <div class="mt-8">
      <button type="button"
        onclick="window.location.href='{{ path('app_task_create') }}'"
        class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-12 text-center hover:border-gray-400 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:outline-hidden">
        <svg viewBox="0 0 48 48"
          fill="none"
          stroke="currentColor"
          aria-hidden="true"
          class="mx-auto size-12 text-gray-400">
          <path d="M8 14v20c0 4.418 7.163 8 16 8 1.381 0 2.721-.087 4-.252M8 14c0 4.418 7.163 8 16 8s16-3.582 16-8M8 14c0-4.418 7.163-8 16-8s16 3.582 16 8m0 0v14m0-4c0 4.418-7.163 8-16 8S8 28.418 8 24m32 10v6m0 0v6m0-6h6m-6 0h-6"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
        <span class="mt-2 block text-sm font-semibold text-gray-900">
          Create a new task
        </span>
      </button>
    </div>
  {% else %}
    <div class="-mx-4 mt-8 sm:-mx-0">
      <table class="min-w-full divide-y divide-gray-300">
        <thead>
          <tr>
            <th scope="col"
              class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 sm:pl-0">
              Task
            </th>
            <th scope="col"
              class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
              Status
            </th>
            <th scope="col"
              class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
              Priority
            </th>
            <th scope="col"
              class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell">
              Team
            </th>
            <th scope="col"
              class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sm:table-cell">
              Due Date
            </th>
            <th scope="col"
              class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 md:table-cell">
              Created By
            </th>
            <th scope="col" class="relative py-3.5 pr-4 pl-3 sm:pr-0">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 bg-white">
          {% for task in tasks %}
            <tr>
              <td class="w-full max-w-0 py-4 pr-3 pl-4 text-sm font-medium text-gray-900 sm:w-auto sm:max-w-none sm:pl-0">
                <a href="{{
                  path(
                    'app_task_show',
                    {
                      taskId: task.id
                    }
                  )
                  }}"
                  class="hover:text-indigo-600 hover:underline">
                  {{ task.title }}
                </a>
                <dl class="font-normal lg:hidden">
                  <div>
                    <dt class="sr-only">
                      Team
                    </dt>
                    <dd class="mt-1 truncate text-gray-700">
                      {{ task.team.name }}
                    </dd>
                  </div>
                  <div class="sm:hidden">
                    <dt class="sr-only">
                      Due Date
                    </dt>
                    <dd class="mt-1 truncate text-gray-500">
                      {% if task.deadline %}
                        {{ task.deadline|date('M j, Y') }}
                      {% else %}
                        No deadline
                      {% endif %}
                    </dd>
                  </div>
                </dl>
              </td>

              <td class="px-3 py-4 text-sm">
                <el-dropdown class="relative flex-none">
                  {% set statusColors = {
                    TODO: 'bg-gray-50 text-gray-600 ring-gray-500/10',
                    IN_PROGRESS: 'bg-blue-50 text-blue-700 ring-blue-600/20',
                    DONE: 'bg-green-50 text-green-700 ring-green-600/20'
                  } %}
                  <button class="inline-flex whitespace-nowrap cursor-pointer items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset {{
                    statusColors[task.status.value]
                    }}">
                    {{ task.status.value == 'TODO'
                      ? 'To Do'
                      : task.status.value == 'IN_PROGRESS'
                        ? 'In Progress'
                        : 'Done' }}
                  </button>
                  <el-menu anchor="bottom end"
                    popover
                    class="w-40 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 transition transition-discrete [--anchor-gap:--spacing(2)] focus:outline-hidden data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in">
                    <form method="POST"
                      class="inline"
                      action="{{
                      path(
                        'app_task_status',
                        {
                          taskId: task.id,
                          status: 'TODO'
                        }
                      )
                      }}">
                      <button type="submit"
                        class="block w-full text-left px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden hover:bg-gray-50">
                        To Do
                      </button>
                    </form>
                    <form method="POST"
                      action="{{
                      path(
                        'app_task_status',
                        {
                          taskId: task.id,
                          status: 'IN_PROGRESS'
                        }
                      )
                      }}"
                      style="display: inline;">
                      <button type="submit"
                        class="block w-full text-left px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden hover:bg-gray-50"
                        style="border: none; background: none;">
                        In Progress
                      </button>
                    </form>
                    <form method="POST"
                      action="{{
                      path(
                        'app_task_status',
                        {
                          taskId: task.id,
                          status: 'DONE'
                        }
                      )
                      }}"
                      style="display: inline;">
                      <button type="submit"
                        class="block w-full text-left px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden hover:bg-gray-50"
                        style="border: none; background: none;">
                        Done
                      </button>
                    </form>
                  </el-menu>
                </el-dropdown>
              </td>

              <td class="px-3 py-4 text-sm">
                <el-dropdown class="relative flex-none">
                  <button class="inline-flex whitespace-nowrap cursor-pointer items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ring-gray-500/20">
                    {{ task.priority.value == 'HIGH'
                      ? 'High'
                      : task.priority.value == 'MEDIUM' ? 'Medium' : 'Low' }}
                  </button>
                  <el-menu anchor="bottom end"
                    popover
                    class="w-40 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 transition transition-discrete [--anchor-gap:--spacing(2)] focus:outline-hidden data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in">
                    <a href="{{
                      path(
                        'app_task_priority',
                        {
                          taskId: task.id,
                          priority: 'HIGH'
                        }
                      )
                      }}"
                      class="block px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden">
                      High
                    </a>
                    <a href="{{
                      path(
                        'app_task_priority',
                        {
                          taskId: task.id,
                          priority: 'MEDIUM'
                        }
                      )
                      }}"
                      class="block px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden">
                      Medium
                    </a>
                    <a href="{{
                      path(
                        'app_task_priority',
                        {
                          taskId: task.id,
                          priority: 'LOW'
                        }
                      )
                      }}"
                      class="block px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden">
                      Low
                    </a>
                  </el-menu>
                </el-dropdown>
              </td>

              <td class="hidden px-3 py-4 text-sm text-gray-500 lg:table-cell">
                {{ task.team.name }}
              </td>

              <td class="hidden px-3 py-4 text-sm text-gray-500 sm:table-cell">
                {% if task.deadline %}
                  {{ task.deadline|date('M j, Y') }}
                {% else %}
                  <span class="text-gray-400">No deadline</span>
                {% endif %}
              </td>

              <td class="hidden px-3 py-4 text-sm text-gray-500 md:table-cell">
                {{ task.createdBy.firstName }} {{ task.createdBy.lastName }}
              </td>

              <td class="py-4 pr-4 pl-3 sm:pr-0">
                <el-dropdown class="relative flex-none">
                  <button class="relative block text-gray-500 hover:text-gray-900">
                    <span class="absolute -inset-2.5"></span>
                    <span class="sr-only">Open options</span>
                    <svg viewBox="0 0 20 20"
                      fill="currentColor"
                      data-slot="icon"
                      aria-hidden="true"
                      class="size-5">
                      <path d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
                    </svg>
                  </button>
                  <el-menu anchor="bottom end"
                    popover
                    class="w-40 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 transition transition-discrete [--anchor-gap:--spacing(2)] focus:outline-hidden data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in">
                    <a href="{{
                      path(
                        'app_task_update',
                        {
                          taskId: task.id
                        }
                      )
                      }}"
                      class="block px-3 py-1 text-sm/6 text-gray-900 focus:bg-gray-50 focus:outline-hidden">
                      Edit<span class="sr-only">, {{ task.title }}</span>
                    </a>
                    <a href="{{
                      path(
                        'app_task_delete',
                        {
                          taskId: task.id
                        }
                      )
                      }}"
                      class="block px-3 py-1 text-sm/6 text-red-600 focus:bg-gray-50 focus:outline-hidden">
                      Delete<span class="sr-only">, {{ task.title }}</span>
                    </a>
                  </el-menu>
                </el-dropdown>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
{% endblock %}
